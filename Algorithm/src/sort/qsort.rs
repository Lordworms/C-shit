//implement a C++ version instead